<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TIS Master System</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 flex min-h-screen">
    <div class="w-72 bg-slate-800 text-white p-6 shadow-xl">
        <h2 class="text-2xl font-bold mb-8 border-b border-slate-700 pb-4">TIS Dashboard</h2>
        <nav class="space-y-4">
            <button onclick="nav('admin')" class="w-full text-left p-3 hover:bg-slate-700 rounded">1. Admin Setup</button>
            <button onclick="nav('subjects')" class="w-full text-left p-3 hover:bg-slate-700 rounded">2. Subject Module</button>
            <button onclick="nav('teachers')" class="w-full text-left p-3 hover:bg-slate-700 rounded">3. Teacher Registry</button>
        </nav>
    </div>

    <main class="flex-1 p-10">
        <div id="admin-view" class="view">
            <h1 class="text-3xl font-bold mb-8 text-slate-800">Admin: User Management</h1>
            <div class="bg-white p-8 rounded-xl shadow-sm border mb-10">
                <div class="grid grid-cols-3 gap-6 mb-6">
                    <div><label class="block text-sm font-bold mb-2">User ID (9 Digits)</label>
                         <input id="u_id" type="text" class="w-full border p-2 rounded"></div>
                    <div><label class="block text-sm font-bold mb-2">First Name</label>
                         <input id="u_f" type="text" class="w-full border p-2 rounded"></div>
                    <div><label class="block text-sm font-bold mb-2">Middle Name</label>
                         <input id="u_m" type="text" class="w-full border p-2 rounded"></div>
                    <div><label class="block text-sm font-bold mb-2">Last Name</label>
                         <input id="u_l" type="text" class="w-full border p-2 rounded"></div>
                    <div><label class="block text-sm font-bold mb-2">Role</label>
                         <select id="u_role" class="w-full border p-2 rounded"><option>Admin</option><option>Branch User</option></select></div>
                </div>
                <button onclick="saveUser()" class="bg-slate-800 text-white px-8 py-2 rounded font-bold hover:bg-slate-900">CREATE USER</button>
            </div>

            <div class="bg-white rounded-xl shadow-sm border overflow-hidden">
                <table class="w-full text-left">
                    <thead class="bg-slate-100"><tr><th class="p-4">ID</th><th class="p-4">Full Name</th><th class="p-4">Role</th><th class="p-4">Actions</th></tr></thead>
                    <tbody id="user-list"></tbody>
                </table>
            </div>
        </div>

        <div id="subjects-view" class="view hidden">
            <h1 class="text-3xl font-bold mb-8 text-slate-800">Subject Registry</h1>
            <div class="bg-white p-8 rounded-xl shadow-sm border mb-6">
                <div class="grid grid-cols-2 gap-6 mb-6">
                    <div><label class="block text-sm font-bold mb-2">Subject Code (AAA999)</label>
                         <input id="s_code" type="text" class="w-full border p-2 rounded"></div>
                    <div><label class="block text-sm font-bold mb-2">Subject Name</label>
                         <input id="s_name" type="text" class="w-full border p-2 rounded"></div>
                    <div><label class="block text-sm font-bold mb-2">Weekly Hours</label>
                         <input id="s_hours" type="number" class="w-full border p-2 rounded"></div>
                    <div><label class="block text-sm font-bold mb-2">Grade Level</label>
                         <select id="s_grade" class="w-full border p-2 rounded">
                            <option>KG1</option><option>KG2</option><option>G1</option><option>G2</option><option>G12</option>
                         </select></div>
                </div>
                <button onclick="saveSubject()" class="bg-blue-600 text-white px-8 py-2 rounded font-bold hover:bg-blue-700">ADD SUBJECT</button>
            </div>
        </div>
    </main>

    <script>
        function nav(id) {
            document.querySelectorAll('.view').forEach(v => v.classList.add('hidden'));
            document.getElementById(id + '-view').classList.remove('hidden');
        }

        async function saveUser() {
            const data = {
                user_id: document.getElementById('u_id').value,
                first_name: document.getElementById('u_f').value,
                middle_name: document.getElementById('u_m').value,
                last_name: document.getElementById('u_l').value,
                role: document.getElementById('u_role').value,
                branch: "Obhur"
            };
            const res = await fetch('/api/users', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(data)});
            if(res.ok) { 
                alert("User Created!"); 
                document.querySelectorAll('input').forEach(i => i.value = ""); // Clear fields
                loadUsers(); 
            }
        }

        async function loadUsers() {
            const res = await fetch('/api/users');
            const users = await res.json();
            const list = document.getElementById('user-list');
            list.innerHTML = users.map(u => `
                <tr class="border-t">
                    <td class="p-4">${u.user_id}</td>
                    <td class="p-4">${u.first_name} ${u.middle_name} ${u.last_name}</td>
                    <td class="p-4 text-blue-600 font-bold">${u.role}</td>
                    <td class="p-4">
                        <button class="text-blue-500 mr-2">Edit</button>
                        ${u.role !== 'Branch User' ? '<button class="text-red-500">Delete</button>' : ''}
                    </td>
                </tr>`).join('');
        }

        window.onload = loadUsers;
    </script>
</body>
</html>